<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Valentine Quest</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        :root { --bg-color: #222; }
        body { margin: 0; padding: 0; background: var(--bg-color); display: flex; flex-direction: column; align-items: center; font-family: 'Courier New', Courier, monospace; overflow: hidden; touch-action: manipulation; }

        /* --- OVERWORLD --- */
        #overworld { position: relative; width: 400px; height: 400px; margin-top: 20px; border: 8px solid #333; background: url('valentines background.png') no-repeat center center; background-size: cover; display: block; }
        
        /* 20% size increase (from 50px to 60px) */
        #player { position: absolute; width: 60px; height: 60px; background: url('valentines yannis sprite.png') no-repeat; background-size: contain; transition: all 0.1s linear; z-index: 10; }
        
        #hint-text { position: absolute; bottom: 10px; width: 100%; text-align: center; color: white; text-shadow: 2px 2px 2px black; font-weight: bold; font-size: 14px; pointer-events: none; }

        /* --- BATTLE SCREEN --- */
        #battle-screen { display: none; position: relative; width: 400px; height: 400px; margin-top: 20px; background: #fff; border: 8px solid #000; }
        .stats-box { position: absolute; background: #f8f8f8; border: 3px solid #444; padding: 5px 10px; width: 160px; box-shadow: 3px 3px 0px #ccc; }
        .opponent-stats { top: 30px; left: 20px; border-radius: 0 10px 0 10px; }
        .player-stats { bottom: 140px; right: 20px; border-radius: 10px 0 10px 0; }
        .hp-bar-container { width: 100%; height: 8px; background: #555; border: 1px solid #000; margin-top: 5px; }
        .hp-bar-fill { width: 100%; height: 100%; background: #4CAF50; transition: width 0.3s; }
        .name-label { font-weight: bold; font-size: 14px; text-transform: uppercase; }

        #opponent-sprite { position: absolute; top: 20px; right: 30px; width: 130px; transition: filter 0.1s; }
        #player-sprite { position: absolute; bottom: 130px; left: 30px; width: 130px; }

        /* Effects */
        #flash { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; display: none; z-index: 1000; }
        .dmg-flash { filter: brightness(0) saturate(100%) invert(27%) sepia(91%) saturate(2352%) hue-rotate(346deg) brightness(104%) contrast(97%) !important; }

        /* --- DIALOGUE UI --- */
        #ui-container { position: absolute; bottom: 0; width: 100%; height: 120px; background: #f8f8f8; border-top: 4px solid #000; display: flex; flex-direction: column; cursor: pointer; }
        #text-box { padding: 15px; font-size: 18px; line-height: 1.4; flex-grow: 1; }
        .blink-arrow { position: absolute; bottom: 10px; right: 20px; font-size: 20px; animation: blink 0.8s infinite; display: none; }
        @keyframes blink { 0% { opacity: 0; } 50% { opacity: 1; } 100% { opacity: 0; } }

        #options-container { display: none; justify-content: space-around; padding: 10px; background: #eee; border-top: 2px solid #000; }
        .battle-btn { padding: 10px 40px; border: 3px solid #000; background: white; cursor: pointer; font-weight: bold; font-size: 18px; }

        /* Mobile Controls */
        .dpad { display: grid; grid-template-columns: repeat(3, 55px); grid-template-rows: repeat(2, 55px); gap: 5px; margin-top: 15px; }
        .btn { width: 55px; height: 55px; background: #eee; border: 2px solid #555; display: flex; align-items: center; justify-content: center; font-size: 24px; border-radius: 10px; }
    </style>
</head>
<body>

    <div id="flash"></div>

    <div id="overworld">
        <div id="player" style="top: 250px; left: 50px;"></div>
        <div id="hint-text">hint: walk towards me...</div>
    </div>

    <div id="battle-screen">
        <div class="stats-box opponent-stats">
            <div class="name-label">Nikhil</div>
            <div class="hp-bar-container"><div class="hp-bar-fill" id="opp-hp"></div></div>
        </div>
        <img src="valentines nikhil sprite.png" id="opponent-sprite">

        <img src="valentines yannis sprite.png" id="player-sprite">
        <div class="stats-box player-stats">
            <div class="name-label">Yannis</div>
            <div class="hp-bar-container"><div class="hp-bar-fill"></div></div>
        </div>

        <div id="ui-container" onclick="advanceDialogue()">
            <div id="text-box"></div>
            <div id="options-container">
                <button class="battle-btn" onclick="handleChoice('yes', event)">YES</button>
                <button class="battle-btn" onclick="handleChoice('no', event)">NO</button>
            </div>
            <div class="blink-arrow" id="arrow">▼</div>
        </div>
    </div>

    <div class="dpad" id="controls">
        <div style="grid-column: 2;" class="btn" onclick="move('up')">▲</div>
        <div style="grid-column: 1; grid-row: 2;" class="btn" onclick="move('left')">◀</div>
        <div style="grid-column: 2; grid-row: 2;" class="btn" onclick="move('down')">▼</div>
        <div style="grid-column: 3; grid-row: 2;" class="btn" onclick="move('right')">▶</div>
    </div>

    <script>
        const player = document.getElementById('player');
        const textElement = document.getElementById('text-box');
        const arrow = document.getElementById('arrow');
        const options = document.getElementById('options-container');
        const flash = document.getElementById('flash');
        const oppSprite = document.getElementById('opponent-sprite');
        const oppHpBar = document.getElementById('opp-hp');

        let px = 50, py = 250;
        let dialogueIndex = 0;
        let isTyping = false;
        let battleStarted = false;
        let nikhilHp = 100;
        let attackIndex = 0;

        const mainDialogue = [
            "Yannis, you are the most beautiful girl in the whole world, inside and out.",
            "You make me feel special and loved.",
            "I have something to ask...",
            "Will you be my Valentine?"
        ];

        const nikhilAttacks = [
            "Nikhil used Flowers & Chocolate!",
            "Nikhil used UberEats!",
            "Nikhil used New Girl binge watch!",
            "Nikhil used Miss Vickies Salt & Vinegar chips!",
            "Nikhil used Wine & Dine!"
        ];

        let currentDialogueSet = mainDialogue;

        function move(dir) {
            if (battleStarted) return;
            if (dir === 'up' && py > 0) py -= 25;
            if (dir === 'down' && py < 340) py += 25;
            if (dir === 'left' && px > 0) px -= 25;
            if (dir === 'right' && px < 340) px += 25;
            player.style.top = py + 'px';
            player.style.left = px + 'px';
            // Trigger near center-left where the board usually is
            if (px > 100 && px < 160 && py > 160 && py < 220) triggerBattleTransition();
        }

        function triggerBattleTransition() {
            battleStarted = true;
            flash.style.display = 'block';
            let count = 0;
            const flashInt = setInterval(() => {
                flash.style.backgroundColor = count % 2 === 0 ? 'black' : 'white';
                count++;
                if (count > 6) {
                    clearInterval(flashInt);
                    flash.style.display = 'none';
                    startBattle();
                }
            }, 100);
        }

        function startBattle() {
            document.getElementById('overworld').style.display = 'none';
            document.getElementById('controls').style.display = 'none';
            document.getElementById('battle-screen').style.display = 'block';
            typeText(currentDialogueSet[dialogueIndex]);
        }

        function typeText(text) {
            isTyping = true;
            arrow.style.display = 'none';
            textElement.innerHTML = "";
            let i = 0;
            const interval = setInterval(() => {
                textElement.innerHTML += text.charAt(i);
                i++;
                if (i >= text.length) {
                    clearInterval(interval);
                    isTyping = false;
                    if (dialogueIndex < currentDialogueSet.length - 1) {
                        arrow.style.display = 'block';
                    } else if (currentDialogueSet === mainDialogue) {
                        options.style.display = 'flex';
                    } else {
                        setTimeout(() => {
                            dialogueIndex = 3;
                            currentDialogueSet = mainDialogue;
                            typeText(currentDialogueSet[dialogueIndex]);
                        }, 1000);
                    }
                }
            }, 30);
        }

        function advanceDialogue() {
            if (isTyping || options.style.display === 'flex') return;
            dialogueIndex++;
            if (dialogueIndex < currentDialogueSet.length) {
                typeText(currentDialogueSet[dialogueIndex]);
            }
        }

        function handleChoice(val, e) {
            e.stopPropagation();
            if (val === 'yes') {
                options.style.display = 'none';
                textElement.innerHTML = "It's super effective! ❤️ Happy Valentine's!";
                oppHpBar.style.width = '0%';
                confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
            } else {
                options.style.display = 'none';
                nikhilHp -= 10;
                oppHpBar.style.width = nikhilHp + '%';
                oppSprite.classList.add('dmg-flash');
                setTimeout(() => oppSprite.classList.remove('dmg-flash'), 200);

                if (nikhilHp <= 0) {
                    currentDialogueSet = [
                        "Nikhil is extremely sad...",
                        "b*tch be fr rn, im finna re-up my health, u better be acting st8 gng"
                    ];
                    nikhilHp = 100;
                    oppHpBar.style.width = '100%';
                } else {
                    const attack = nikhilAttacks[attackIndex];
                    attackIndex = (attackIndex + 1) % nikhilAttacks.length;
                    currentDialogueSet = ["Nikhil is sad...", attack, "It's super effective! You're trapped in love!"];
                }
                dialogueIndex = 0;
                typeText(currentDialogueSet[dialogueIndex]);
            }
        }

        window.addEventListener('keydown', (e) => {
            if (!battleStarted) {
                if (e.key === 'ArrowUp') move('up');
                if (e.key === 'ArrowDown') move('down');
                if (e.key === 'ArrowLeft') move('left');
                if (e.key === 'ArrowRight') move('right');
            } else if (!isTyping && (e.key === 'Enter' || e.key === ' ')) {
                advanceDialogue();
            }
        });
    </script>
</body>
</html>
